---
version: 1.0.0

name: New Device
description: "My new Device"
logs: stdout        # "off", stdout, stderr, /path/to/file
logLvl: info        # trace | debug | info | warn | error | fatal | panic

slave:
  port: /dev/ttyUSB0
  boundRate: 115200
  dataBits: 8
  parity: N         # Parity: N - None, E - Even, O - Odd (default E)
  stopBits: 2
  silentInterval: 50ms

  # Порядок байт
  byteOrder: "big" # little

  # Не изменяемые параметры можно обращаться просто start
  const:
    start:
      - 0xC3
      - 0xC3
    stop:
      - 0xFE
      - 0xFC
    addressMaster:
      - 0x01
    addressSlave:
      - 0x02

  # Параметры staffing байта и константы которые подлежат экранированию
  staffing:
    byte:
      - 0x00
    pattern:
      - start
      - stop

  maxLen: 255
  # Обращение к значениям происходит с помощью len#write
  len:
    # считает длину с установленным staffing
    staffing: true
    # Длина длины в байтах
    coundBytes: 1
    read:
      - test#expected
    write:
      - test#writed
    error:
      - test#error

  # Обращение к значениям происходит с помощью crc#write
  crc:
    # Алгоритм crc
    algorithm: mod256
    # Экранировать данные staffing байтом перед подсчетом не влияет на длину
    staffing: true
    read:
      - addressSlave
      - addressMaster
      - _len_#
      - test_#
    write:
      - addressMaster
      - addressSlave
      - _len_#
      - test_#
    error:
      - addressMaster
      - addressSlave
      - _len_#
      - test_#

  # Тут происходит не явное обработка staffing. Поля что входят в pattern не экранируются
  writeFormat:
    - start
    - addressMaster
    - addressSlave
    - _len_#
    - test_#
    - crc_#
    - stop

  # Тут происходит не явное удаление staffing. Поля что входят в pattern не преобразуются
  readFormat:
    - start
    - addressMaster
    - addressSlave
    - _len_#
    - test_#
    - crc_#
    - stop

  # Тут происходит не явное удаление staffing. Поля что входят в pattern не преобразуются
  errorFormat:
    - start
    - addressMaster
    - addressSlave
    - _len_#
    - test_#
    - crc_#
    - stop

  tests:

    Default:
      - name: TestName  # Test Name
        skip: пока пропустить

        # Сообщение перед тестом
        before: "the message after the test"

        # Строги порядок выполнения команд
        next:
          - TestName


        fatal: exit

        # Количество запусков
        lifetime: 1

        # Задержка перед ответом
        timeout: 2s

        # Определяет что запрос пришел для этого теста. Подставляется в поле test#expected
        pattern:
          - name: "param1"
            # начиная с какого бита это значение по умолчанию 0
            address: 0x00
            uint8: 8

        write:
          - name: "param1"
            uint16: 1
          - name: "param2"
            uint32: 2

        writeError:
          - name: "param1"
              uint16: 1
          - name: "param2"
              uint32: 2

        expected:
          - name: no error
            error:
          - name: execution time
            time: 1s
          - name: quantity
            uint16: 0xffff

        success: "the message on successful completion of the test"
        error: "the message about the failed test execution"
        after: "the message after the test"
